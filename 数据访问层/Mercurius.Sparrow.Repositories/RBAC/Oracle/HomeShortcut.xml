<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Mercurius.Sparrow.Repositories.RBAC.HomeShortcut" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="HomeShortcut" type="Mercurius.Sparrow.Entities.RBAC.HomeShortcut, Mercurius.Sparrow.Entities" />
  </alias>

  <statements>

    <!-- 获取首页快捷方式 -->
    <select id="GetHomeShortcuts" parameterClass="string" resultClass="HomeShortcut">
      <![CDATA[
        SELECT 
          Id           AS "Id"
          ,UserId      AS "UserId"
          ,Name        AS "Name"
          ,NavigateUrl AS "NavigateUrl"
          ,Target      AS "Target"
          ,Image       AS "Image"
          ,Sort        AS "Sort"
          ,Remark      AS "Remark"
        FROM RBAC.HomeShortcut
        WHERE UserId=#value#
        ORDER BY Sort ASC
      ]]>
    </select>

    <!-- 获取首页快捷方式信息 -->
    <select id="GetHomeShortcut" parameterClass="string" resultClass="HomeShortcut">
      <![CDATA[
        SELECT 
          Id           AS "Id"
          ,UserId      AS "UserId"
          ,Name        AS "Name"
          ,NavigateUrl AS "NavigateUrl"
          ,Target      AS "Target"
          ,Image       AS "Image"
          ,Sort        AS "Sort"
          ,Remark      AS "Remark"
        FROM RBAC.HomeShortcut
        WHERE Id=#value#
      ]]>
    </select>

    <!-- 添加首页快捷方式 -->
    <insert id="CreateOrUpdate" parameterClass="HomeShortcut">
      <![CDATA[
        MERGE INTO RBAC.HomeShortcut hs
        USING (SELECT * FROM RBAC.HomeShortcut WHERE Id=#Id#) src
        ON (hs.Id=src.Id)
        WHEN MATCHED THEN
          UPDATE SET
            hs.Name=#Name#,
            hs.NavigateUrl=#NavigateUrl#,
            hs.Target=#Target#,
            hs.Image=#Image#,
            hs.Sort=#Sort#,
            hs.Remark=#Remark#
        WHEN NOT MATCHED THEN 
          INSERT
          (
            hs.Id,
            hs.UserId,
            hs.Name,
            hs.NavigateUrl,
            hs.Target,
            hs.Image,
            hs.Sort,
            hs.Remark
          )
          values
          (
            #Id#,
            #UserId#,
            #Name#,
            #NavigateUrl#,
            #Target#,
            #Image#,
            #Sort#,
            #Remark#
          )
      ]]>
    </insert>

    <!-- 删除用户首页快捷方式 -->
    <delete id="Remove" parameterClass="Params">
      <![CDATA[
        Delete FROM RBAC.HomeShortcut WHERE UserId=#UserId# AND Id IN
      ]]>
      <iterate property="HomeShortcutIds" open="(" close=")" conjunction=",">
        #HomeShortcutIds[]#
      </iterate>
    </delete>
  </statements>
</sqlMap>