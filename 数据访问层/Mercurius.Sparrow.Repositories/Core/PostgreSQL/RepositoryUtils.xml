<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Mercurius.Sparrow.Repositories.Core.RepositoryUtils" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="Partition" type="Mercurius.Sparrow.Entities.Core.Partition, Mercurius.Sparrow.Entities" />
  </alias>

  <resultMaps>
    <resultMap id="GetPartitionsRM" class="Partition">
      <result property="Name" column="PARTITION_NAME" />
      <result property="HightValue" column="HIGH_VALUE" dbType="RAW" type="string" />
    </resultMap>
  </resultMaps>

  <statements>

    <!-- 判断数据库表的字段是否存在 -->
    <select id="IsColumnExists" parameterClass="Params" resultClass="int">
      <![CDATA[
        SELECT 1 where EXISTS(
          SELECT * FROM information_schema.columns
          where table_name=#Table# and column_name=#Column#
      ]]>
      <dynamic>
        <isNotEmpty property="Schema" prepend="AND">
          table_schema=#Schema#
        </isNotEmpty>
      </dynamic>
      <![CDATA[
        )
      ]]>
    </select>

    <!-- 获取表的分区 -->
    <select id="GetPartitions" parameterClass="string" resultClass="DataTable">
      <![CDATA[
        
      ]]>
    </select>

    <!-- 判断表中的数据是否存在 -->
    <select id="IsDataExists" parameterClass="Params" resultClass="int">
      <![CDATA[
        SELECT 1 WHERE EXISTS(SELECT * FROM "$Schema$"."$Table$" WHERE "Status"=1 AND "$Column$" IN
      ]]>
      <iterate property="Values" open="(" close="))" conjunction=",">
        #Values[]#
      </iterate>
    </select>
  </statements>
</sqlMap>