<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<sqlMap namespace="Mercurius.Sparrow.Repositories.WebApi.RolePermission" xmlns="http://ibatis.apache.org/mapping">
  <alias>
    <typeAlias alias="RolePermission" type="Mercurius.Sparrow.Entities.WebApi.RolePermission, Mercurius.Sparrow.Entities" />
    <typeAlias alias="RolePermissionSO" type="Mercurius.Sparrow.Entities.WebApi.SO.RolePermissionSO, Mercurius.Sparrow.Entities" />
  </alias>
  <statements>
    <!-- 添加WebApi权限列表信息。 -->
    <insert id="Create" parameterClass="Params">
      <![CDATA[
        DELETE FROM [WebApi].[RolePermission] WHERE [RoleId]=#RoleId#;
      ]]>
      <iterate property="Permissions" open="" conjunction=";" close=";">
        <![CDATA[
          INSERT INTO [WebApi].[RolePermission]
          (
            [RoleId],
            [ApiId],
            [CreateUserId],
            [CreateDateTime]
          )
          VALUES
          (
            #Permissions[].RoleId#,
            #Permissions[].ApiId#,
            #Permissions[].CreateUserId#,
            GETDATE()
          )
        ]]>
      </iterate>
    </insert>

    <!-- 分页返回满足查询条件的WebApi权限列表信息。 -->
    <select id="GetRolePermissions" parameterClass="int" resultClass="RolePermission">
      <![CDATA[
        SELECT
          [Id] AS Id,
          [RoleId] AS RoleId,
          [ApiId] AS ApiId,
          [CreateUserId] AS CreateUserId,
          [CreateDateTime] AS CreateDateTime
        FROM [WebApi].[RolePermission]
        WHERE RoleId=#value#
      ]]>
    </select>
  </statements>
</sqlMap>