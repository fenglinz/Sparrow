<UserControl x:Class="Mercurius.CodeBuilder.UI.Views.CodeBuilderView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:mvvm="http://www.galasoft.ch/mvvmlight"
             xmlns:para="clr-namespace:System.Windows;assembly=PresentationFramework"
             xmlns:prism="http://www.codeplex.com/prism"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             d:DesignHeight="800"
             d:DesignWidth="1024"
             mc:Ignorable="d">
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedCommand}" CommandParameter="loadingAn" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <UserControl.Resources>
        <Style x:Key="{x:Type CheckBox}" TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalAlignment" Value="Top" />
        </Style>
    </UserControl.Resources>
    <Grid Background="WhiteSmoke">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Name="buildNotify"
                    Panel.ZIndex="200"
                    Grid.RowSpan="3"
                    Width="Auto"
                    Height="Auto"
                    Background="#a5a5">
            <Path
                Name="busyPath"
                Width="68"
                Height="68"
                Margin="0,350,0,0"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Data="M32.622449,49.151997C37.460866,49.151997 41.379999,53.071453 41.379999,57.910248 41.379999,62.747639 37.460866,66.667 32.622449,66.667 27.785231,66.667 23.865998,62.747639 23.865998,57.910248 23.865998,53.071453 27.785231,49.151997 32.622449,49.151997z M50.136299,42.098999C54.973488,42.098999 58.893999,46.019512 58.893999,50.856701 58.893999,55.693791 54.973488,59.612999 50.136299,59.612999 45.299309,59.612999 41.379999,55.693791 41.379999,50.856701 41.379999,46.019512 45.299309,42.098999 50.136299,42.098999z M15.536325,42.098999C20.3747,42.098999 24.293999,46.019512 24.293999,50.856701 24.293999,55.693791 20.3747,59.612999 15.536325,59.612999 10.699248,59.612999 6.7799988,55.693791 6.7799988,50.856701 6.7799988,46.019512 10.699248,42.098999 15.536325,42.098999z M57.2693,24.577C62.10639,24.577 66.027002,28.4963 66.027002,33.3335 66.027002,38.1707 62.10639,42.089996 57.2693,42.089996 52.432308,42.089996 48.512999,38.1707 48.512999,33.3335 48.512999,28.4963 52.432308,24.577 57.2693,24.577z M8.7576199,24.577C13.594844,24.577 17.513999,28.4963 17.513999,33.3335 17.513999,38.1707 13.594844,42.089996 8.7576199,42.089996 3.9191437,42.089996 0,38.1707 0,33.3335 0,28.4963 3.9191437,24.577 8.7576199,24.577z M50.136299,7.0619995C54.973488,7.0619999 58.893999,10.981457 58.893999,15.818851 58.893999,20.657543 54.973488,24.577 50.136299,24.577 45.299309,24.577 41.379999,20.657543 41.379999,15.818851 41.379999,10.981457 45.299309,7.0619999 50.136299,7.0619995z M15.536325,7.0619995C20.3747,7.0619999 24.293999,10.981457 24.293999,15.818851 24.293999,20.657543 20.3747,24.577 15.536325,24.577 10.699248,24.577 6.7799988,20.657543 6.7799988,15.818851 6.7799988,10.981457 10.699248,7.0619999 15.536325,7.0619995z M32.622447,0C37.460865,1.4144285E-07 41.379999,3.9191832 41.379999,8.7563201 41.379999,13.594768 37.460865,17.514 32.622447,17.514 27.785232,17.514 23.865999,13.594768 23.865998,8.7563201 23.865999,3.9191832 27.785232,1.4144285E-07 32.622447,0z"
                Fill="LimeGreen"
                RenderTransformOrigin="0.5,0.5"
                Stretch="Uniform">
                <Path.RenderTransform>
                    <RotateTransform x:Name="busy" Angle="0" />
                </Path.RenderTransform>
                <Path.Triggers>
                    <EventTrigger RoutedEvent="UserControl.Loaded">
                        <BeginStoryboard>
                            <Storyboard AutoReverse="False" RepeatBehavior="Forever">
                                <DoubleAnimation
                                    Duration="00:00:1.5"
                                    From="0"
                                    Storyboard.TargetName="busy"
                                    Storyboard.TargetProperty="Angle"
                                    To="360" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Path.Triggers>
            </Path>
            <TextBlock Name="buildMessage"
                       Margin="0,8,0,0"
                       HorizontalAlignment="Center"
                       FontSize="18" Foreground="DarkBlue">正在处理中，请稍后...</TextBlock>
        </StackPanel>

        <Grid>
            <GroupBox Height="165"
                      Margin="5,5,5,5"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Header="基本信息">
                <GroupBox.Content>
                    <Grid>
                        <Label Margin="58,1,0,0" Content="作者：" />
                        <TextBox Width="160"
                                 Margin="110,0,0,0"
                                 Text="{Binding Configuration.Author}" />

                        <Label Margin="16,35,0,0" Content="根命名空间：" />
                        <TextBox Margin="110,35,30,0"
                                 HorizontalAlignment="Stretch"
                                 Text="{Binding Configuration.BaseNamespace}" />

                        <Label Margin="30,73,0,0" Content="生成语言：" />
                        <ComboBox Width="80"
                                  Margin="110,72,0,0"
                                  Text="{Binding Configuration.Language}">
                            <ComboBoxItem Content="C#" IsSelected="True" />
                            <ComboBoxItem Content="Java" />
                        </ComboBox>

                        <Label Margin="250,73,0,0" Content="生成日期：" />
                        <DatePicker Width="150"
                                    Margin="331,76,0,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    SelectedDate="{x:Static sys:DateTime.Now}"
                                    Text="{Binding Configuration.BuildDate}" />

                        <Label Margin="549,72,0,0">版权拥有者：</Label>
                        <TextBox Margin="642,71,30,0" HorizontalAlignment="Stretch" Text="{Binding Configuration.CopyrightOwner}" />

                        <Label Margin="30,108,0,0" Content="输出目录：" />
                        <TextBox Margin="110,107,65,0"
                                 HorizontalAlignment="Stretch"
                                 IsReadOnly="True"
                                 Text="{Binding Configuration.OutputFolder}" />
                        <Button Width="30"
                                Margin="0,107,30,0"
                                HorizontalAlignment="Right"
                                Command="{Binding SelectFolderCommand}"
                                Content="..."
                                Padding="0,5.5" />
                    </Grid>
                </GroupBox.Content>
            </GroupBox>
        </Grid>

        <Grid Grid.Row="1"
              Background="WhiteSmoke"
              DataContext="{Binding Configuration.Tables}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <ListBox Grid.RowSpan="2" Width="280" Margin="0,0,0,5"
                     IsSynchronizedWithCurrentItem="True"
                     ItemsSource="{Binding}"
                     SelectedIndex="0"
                     Style="{x:Null}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border>
                            <StackPanel Orientation="Horizontal">
                                <CheckBox Margin="0,5,0,5" IsChecked="{Binding IsEnabled}">
                                    <CheckBox.Template>
                                        <ControlTemplate TargetType="CheckBox">
                                            <Image x:Name="img1"
                                                   Width="36"
                                                   Height="36"
                                                   Source="../Images/add.png" />

                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsChecked" Value="true">
                                                    <Setter TargetName="img1" Property="Source" Value="../Images/add.png" />
                                                </Trigger>
                                                <Trigger Property="IsChecked" Value="false">
                                                    <Setter TargetName="img1" Property="Source" Value="../Images/remove.png" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </CheckBox.Template>
                                </CheckBox>
                                <StackPanel Margin="5,5,0,5" Orientation="Vertical">
                                    <TextBlock Text="{Binding Name}" />
                                    <TextBlock Margin="0,5,0,0"
                                               FontSize="15"
                                               FontStyle="Italic"
                                               Text="{Binding StringFormat='类名 : {0}',
                                                              Path=ClassName}" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Path Grid.RowSpan="2"
                  Name="loadingAn"
                  Width="68"
                  Height="68"
                  Margin="0,0,0,0"
                  Panel.ZIndex="99"
                  Data="M32.622449,49.151997C37.460866,49.151997 41.379999,53.071453 41.379999,57.910248 41.379999,62.747639 37.460866,66.667 32.622449,66.667 27.785231,66.667 23.865998,62.747639 23.865998,57.910248 23.865998,53.071453 27.785231,49.151997 32.622449,49.151997z M50.136299,42.098999C54.973488,42.098999 58.893999,46.019512 58.893999,50.856701 58.893999,55.693791 54.973488,59.612999 50.136299,59.612999 45.299309,59.612999 41.379999,55.693791 41.379999,50.856701 41.379999,46.019512 45.299309,42.098999 50.136299,42.098999z M15.536325,42.098999C20.3747,42.098999 24.293999,46.019512 24.293999,50.856701 24.293999,55.693791 20.3747,59.612999 15.536325,59.612999 10.699248,59.612999 6.7799988,55.693791 6.7799988,50.856701 6.7799988,46.019512 10.699248,42.098999 15.536325,42.098999z M57.2693,24.577C62.10639,24.577 66.027002,28.4963 66.027002,33.3335 66.027002,38.1707 62.10639,42.089996 57.2693,42.089996 52.432308,42.089996 48.512999,38.1707 48.512999,33.3335 48.512999,28.4963 52.432308,24.577 57.2693,24.577z M8.7576199,24.577C13.594844,24.577 17.513999,28.4963 17.513999,33.3335 17.513999,38.1707 13.594844,42.089996 8.7576199,42.089996 3.9191437,42.089996 0,38.1707 0,33.3335 0,28.4963 3.9191437,24.577 8.7576199,24.577z M50.136299,7.0619995C54.973488,7.0619999 58.893999,10.981457 58.893999,15.818851 58.893999,20.657543 54.973488,24.577 50.136299,24.577 45.299309,24.577 41.379999,20.657543 41.379999,15.818851 41.379999,10.981457 45.299309,7.0619999 50.136299,7.0619995z M15.536325,7.0619995C20.3747,7.0619999 24.293999,10.981457 24.293999,15.818851 24.293999,20.657543 20.3747,24.577 15.536325,24.577 10.699248,24.577 6.7799988,20.657543 6.7799988,15.818851 6.7799988,10.981457 10.699248,7.0619999 15.536325,7.0619995z M32.622447,0C37.460865,1.4144285E-07 41.379999,3.9191832 41.379999,8.7563201 41.379999,13.594768 37.460865,17.514 32.622447,17.514 27.785232,17.514 23.865999,13.594768 23.865998,8.7563201 23.865999,3.9191832 27.785232,1.4144285E-07 32.622447,0z"
                  Fill="LimeGreen"
                  RenderTransformOrigin="0.5,0.5"
                  Stretch="Uniform">
                <Path.RenderTransform>
                    <RotateTransform x:Name="loading" Angle="0" />
                </Path.RenderTransform>
                <Path.Triggers>
                    <EventTrigger RoutedEvent="UserControl.Loaded">
                        <BeginStoryboard>
                            <Storyboard AutoReverse="False" RepeatBehavior="Forever">
                                <DoubleAnimation Duration="00:00:1.5"
                                                 From="0"
                                                 Storyboard.TargetName="loading"
                                                 Storyboard.TargetProperty="Angle"
                                                 To="360" />
                            </Storyboard>
                        </BeginStoryboard>
                    </EventTrigger>
                </Path.Triggers>
            </Path>

            <GroupBox Grid.Column="1" Margin="5">
                <GroupBox.Header>代码生成设置</GroupBox.Header>
                <GroupBox.Content>
                    <Grid IsEnabled="{Binding IsEnabled}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid Height="160">
                            <Label Margin="52,5,0,0" Content="模块：" />
                            <TextBox Width="260"
                             Margin="105,6,0,0"
                             Text="{Binding ModuleName,
                                            UpdateSourceTrigger=PropertyChanged}" />

                            <Label Margin="379,5,0,0" Content="模块描述：" />
                            <TextBox Margin="460,6,20,0"
                             HorizontalAlignment="Stretch"
                             Text="{Binding ModuleDescription,
                                            UpdateSourceTrigger=PropertyChanged}" />

                            <Label Margin="52,47,0,0" Content="类名：" />
                            <TextBox Margin="105,47,0,0"
                             Width="260"
                             Text="{Binding ClassName,
                                            UpdateSourceTrigger=PropertyChanged}" />

                            <Label Margin="393,47,0,0" Content="类描述：" />
                            <TextBox Margin="460,47,20,0"
                             HorizontalAlignment="Stretch"
                             Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" />
                            <Label Margin="24,89,0,0" Content="生成操作：" />
                            <CheckBox Margin="105,97,0,0" Content="仅实体类" IsChecked="{Binding IsEntityOnly, UpdateSourceTrigger=PropertyChanged}" />
                            <StackPanel Margin="200,97,0,0" Orientation="Horizontal">
                                <StackPanel.Resources>
                                    <Style x:Key="{x:Type CheckBox}" TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
                                        <Setter Property="Margin" Value="0,0,15,0" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsEntityOnly}" Value="true">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Resources>
                                <CheckBox Content="添加" IsChecked="{Binding HasCreate}" />
                                <CheckBox Content="修改" IsChecked="{Binding HasUpdate}" />
                                <CheckBox Content="添加并修改" IsChecked="{Binding HasCreateOrUpdate}" />
                                <CheckBox Content="删除" IsChecked="{Binding HasRemove}" />
                                <CheckBox Content="单条数据" IsChecked="{Binding HasSingleData}" />
                                <CheckBox Content="分页查询" IsChecked="{Binding HasSearchData}" />
                            </StackPanel>
                        </Grid>
                    </Grid>
                </GroupBox.Content>
            </GroupBox>

            <DataGrid Grid.Row="1" Grid.Column="1"
                      Margin="5,0,5,3"
                    VerticalAlignment="Stretch"
                    ItemsSource="{Binding Columns}">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Width="Auto"
                                                Header="列名"
                                                IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <ItemContainerTemplate>
                                <TextBlock VerticalAlignment="Center"
                                               Padding="8,0"
                                               Text="{Binding Name}" />
                            </ItemContainerTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="1*"
                                                Header="类型"
                                                IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <ItemContainerTemplate>
                                <TextBlock VerticalAlignment="Center"
                                               Padding="8,0"
                                               Text="{Binding SqlType}" />
                            </ItemContainerTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="2*" Header="属性名">
                        <DataGridTemplateColumn.CellTemplate>
                            <ItemContainerTemplate>
                                <TextBox HorizontalAlignment="Stretch" Text="{Binding PropertyName, UpdateSourceTrigger=PropertyChanged}" />
                            </ItemContainerTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="80" Header="查询">
                        <DataGridTemplateColumn.CellTemplate>
                            <ItemContainerTemplate>
                                <CheckBox HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              IsChecked="{Binding IsSearchCriteria,
                                                                  UpdateSourceTrigger=PropertyChanged}" />
                            </ItemContainerTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Width="3*" Header="描述">
                        <DataGridTemplateColumn.CellTemplate>
                            <ItemContainerTemplate>
                                <TextBox HorizontalAlignment="Stretch" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" />
                            </ItemContainerTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <Grid Grid.Row="2"
              Height="45"
              Background="#9070">
            <Button Margin="0,8,5,0" 
                    HorizontalAlignment="Right"
                    Command="{Binding CreateTableDefinitionCommand }"
                    Content="生成表定义文档" />
            <Button Margin="0,8,160,0"
                    HorizontalAlignment="Right"
                    Command="{Binding InitializeProjectCommand}" 
                    Content="初始化项目"
                    ToolTip="请在应用程序的Projects文件夹中存入CSharp.zip基础项目文件。" />
            <Button Margin="0,8,287,0"
                    HorizontalAlignment="Right"
                    Command="{Binding BuildingCommand}"
                    Content="生成" IsDefault="True" />
        </Grid>
    </Grid>
</UserControl>
